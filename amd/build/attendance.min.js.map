{"version":3,"sources":["../src/attendance.js"],"names":["define","$","Ajax","Log","Chart","AttendanceControl","origin","self","element","document","getElementById","username","getAttribute","campus","prototype","main","setupEvents","getAttendanceChart","on","getAttendanceRollmarking","click","trigger","removeAttr","toggle","call","methodname","args","done","response","htmlResult","html","attr","replaceWith","fail","reason","error","debug","userid","querySelector","firstElementChild","style","display","result","renderAttendanceBarChar","results","ctx","JSON","parse","data","labels","i","length","push","filesemester","totalpercentageattended","type","datasets","label","tension","borderWidth","borderRadius","borderSkipped","borderColor","backgroundColor","maxBarThickness","options","responsive","maintainAspectRatio","scales","y","suggestedMax","min","plugins","tooltip","callbacks","context","Y","log","parsed","init","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   report_mystudent\n * @copyright 2022 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/log', 'report_mystudent/chart'], function ($, Ajax, Log, Chart) {\n    'use strict';\n\n    function init(origin) {\n        Log.debug(\"mystudent: attendance report : initialising controls\");\n        var control = new AttendanceControl(origin);\n        control.main(origin);\n    }\n\n    /**\n     * AttendanceControl a single block_assignmentsquizzes_report block instance contents.\n     *\n     * @constructor\n     */\n    function AttendanceControl(origin) {\n        let self = this;\n\n        if (origin != 'dashboard') {\n            const element = document.getElementById('rollmarking-container');\n            const username = element.getAttribute('data-username');\n            const campus = element.getAttribute('data-campus');\n            self.username = username;\n            self.campus = campus;\n        }\n    }\n\n    /**\n     * Run the controller.\n     *\n     */\n    AttendanceControl.prototype.main = function (origin) {\n        let self = this;\n        if (origin != 'dashboard') {\n            self.setupEvents();\n        } else {\n            self.getAttendanceChart();\n        }\n\n    };\n\n    AttendanceControl.prototype.setupEvents = function () {\n        let self = this;\n\n        $('.attendance-rollmarking').on('custom.getAttendanceRollmarking', function () {\n            self.getAttendanceRollmarking();\n        });\n\n        $('.attendance-rollmarking').click(function () {\n            $(this).trigger(\"custom.getAttendanceRollmarking\");\n        });\n    };\n\n    AttendanceControl.prototype.getAttendanceRollmarking = function () {\n        let self = this;\n        const username = self.username;\n        const campus = self.campus;\n\n        // Add spinner.\n        $('#attendance-based-on-rollmarking-table').removeAttr('hidden');\n        $('#attendance-based-on-rollmarking-show').toggle(); // Carret down.\n        $('#attendance-based-on-rollmarking-hide').toggle(); // Carret right\n\n        Ajax.call([{\n            methodname: 'report_mystudent_get_attendance_rollmarking_context',\n            args: {\n                username: username,\n                campus: campus\n            },\n\n            done: function (response) {\n                const htmlResult = response.html;\n\n                $('#attendance-based-on-rollmarking-table').attr('hidden', true);\n                $('[data-region=\"attendance-rollmarking\"]').replaceWith(htmlResult);\n            },\n\n            fail: function (reason) {\n                Log.error('block_attendance_report_get_attendance_rollmarking_context: Unable to get context.');\n                Log.debug(reason);\n                $('[data-region=\"attendance-rollmarking\"]').replaceWith('<p class=\"alert alert-danger\">Data not available. Please try later</p>');\n            }\n        }]);\n\n    };\n\n    AttendanceControl.prototype.getAttendanceChart = function () {\n        const self = this;\n        const userid = document.querySelector('.card-deck').getAttribute('data-userid')\n        const campus = document.querySelector('[data-campus]').getAttribute('data-campus');\n\n        // document.getElementById('chart-attendance').nextElementSibling.removeAttribute('hidden');\n        document.querySelector('.card-img-attendance').firstElementChild.style.display = \"flex\";\n\n\n        Ajax.call([{\n            methodname: 'report_mystudent_get_attendance_by_term',\n            args: {\n                userid: userid,\n                campus: campus\n            },\n\n            done: function (response) {\n                const htmlResult = response.result;\n                Log.debug(htmlResult);\n                Log.debug(self);\n                self.renderAttendanceBarChar(htmlResult);\n\n            },\n\n            fail: function (reason) {\n                Log.debug(reason);\n                // remove spinner\n                //document.querySelector('.card-body-attendance').firstElementChild.style.display = \"none\";\n                document.querySelector('.card-img-attendance').firstElementChild.style.display = \"none\";\n                $('#card-body-attendance-info-text').replaceWith('<p class=\"card-text alert alert-danger\" id =\"card-body-attendance-info-text\" >Data not available. Please try later</p>');\n            }\n        }]);\n\n    }\n\n    AttendanceControl.prototype.renderAttendanceBarChar = function (results) {\n        const ctx = document.getElementById(\"chart-attendance\");\n\n        if (!ctx) {\n            return;\n        }\n\n        const result = JSON.parse(results);\n        const data = [];\n        const labels = [];\n\n        for (let i = 0; i < result.length; i++) {\n\n            labels.push(`Term ${result[i].filesemester}`);\n            data.push(result[i].totalpercentageattended);\n           \n        }\n\n        const config = {\n            type: 'bar',\n            data: {\n                labels: labels,\n                datasets: [{\n                    label: 'Term',\n                    tension: 0.4,\n                    borderWidth: 0,\n                    borderRadius: 4,\n                    borderSkipped: false,\n                    borderColor: '#ffc93c',\n                    backgroundColor: '#ffc93c',\n                    data: data,\n                    maxBarThickness: 6\n                }]\n\n            },\n            options: {\n                responsive: true,\n                maintainAspectRatio: false,\n                scales: {\n                    y: {\n                        suggestedMax: 100,\n                        min: 1,\n                    }\n                },\n                plugins: {\n                    tooltip: {\n                        callbacks: {\n                            label: function (context) {\n                                Y.log(context);\n                                return `${context.parsed.y} %`\n                            },\n                        }\n                    },\n                },\n            },\n        };\n\n        // remove spinner\n    //    document.querySelector('.card-body-attendance').firstElementChild.style.display = \"none\";\n       document.querySelector('.card-img-attendance').firstElementChild.style.display = \"none\";\n        const myChart = new Chart(ctx, config);\n    }\n\n\n\n\n    return {\n        init: init\n    }\n});"],"file":"attendance.min.js"}