/**
 * @package   report_mystudent
 * @copyright 2022 Veronica Bermegui
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_mystudent/gradesandeffort",["jquery","core/ajax","core/log","report_mystudent/chart"],(function($,Ajax,Log,Chart){function AcademicInfo(){}return AcademicInfo.prototype.main=function(){"Senior"==document.querySelector("[data-username]").getAttribute("data-campus")?(this.trendChartSenior(),this.getGradeHistory(),this.getEffortHistory()):this.trendChartPrimary()},AcademicInfo.prototype.trendChartSenior=function(){var ctx=document.getElementById("trendChart");if(ctx){for(var performanceEl=document.querySelector("#performance"),performance=JSON.parse(performanceEl.dataset.performance),labels=[],sets=[],attendance=[],effort=[],grades=[],gradeperterm=[],TAGS_avgattendance="Average Attendance",TAGS_avgeffort="Average Effort",TAGS_avggrades="Average Grade",i=0;i<performance.length;i++){var p=performance[i],year=p.details.year.toString(),term=p.details.term.toString();labels.push(["T"+term,year]),gradeperterm.push(p.details.avggrades),grades.push(p.details.avggrades),effort.push(p.details.avgeffort),attendance.push(p.details.avgattendance)}sets.push({label:TAGS_avggrades,data:grades,fill:!1,borderColor:"#31326f",backgroundColor:"#31326f",tension:.1}),sets.push({label:TAGS_avgeffort,data:effort,fill:!1,borderColor:"#ffc93c",backgroundColor:"#ffc93c",tension:.1}),sets.push({label:TAGS_avgattendance,data:attendance,fill:!1,borderColor:"#1687a7",backgroundColor:"#1687a7",tension:.1});new Chart(ctx,{type:"line",data:{labels:labels,datasets:sets},options:{responsive:!0,maintainAspectRatio:!1},plugins:[{id:"custom_canvas_background_color",beforeDraw:function(chart){var ctx=chart.canvas.getContext("2d");ctx.save(),ctx.globalCompositeOperation="destination-over",ctx.fillStyle="#f6f5f5",ctx.fillRect(0,0,chart.width,chart.height),ctx.restore()}}]})}},AcademicInfo.prototype.trendChartPrimary=function(){var ctx=document.getElementById("trendChart");if(ctx){for(var performanceEl=document.querySelector("#performance"),performance=JSON.parse(performanceEl.dataset.performance),labels=[],sets=[],attendance=[],effort=[],grades=[],TAGS_avgattendance="Average Attendance",TAGS_avgeffort="Average Effort",TAGS_avggrades="Average Grade",TAGS_EFFORTS_DESC_e="Excellent (E)",TAGS_EFFORTS_DESC_vg="Very Good (VG)",TAGS_EFFORTS_DESC_avg="Average (AVG)",TAGS_EFFORTS_DESC_ni="Needs Improvement (NI)",TAGS_GRADES_DESC_be="Below Expectations",TAGS_GRADES_DESC_gs="Good start (GS)",TAGS_GRADES_DESC_ms="Making strides (MS)",TAGS_GRADES_DESC_grwi="Go run with it (GRWI)",TAGS_GRADES_DESC_ae="Above expectations",segments=function(dataset){for(var hasval=[],noval=[],segment=[],i=0;i<dataset.length;i++)null==dataset[i]?noval.push(i):hasval.push(i);for(var _i=0,_noval=noval;_i<_noval.length;_i++){var index=_noval[_i];if(index>0&&index<dataset.length-1){var seg=[getStartPoint(dataset,index),getEndPoint(dataset,index)];segment.push(seg)}}segment=segment.filter((function(element){return void 0!==element}))},getEndPoint=function(dataset,currindex){for(var flag=!0,i=++currindex;flag&&i<dataset.length;)null!=dataset[i]?flag=!1:i++;return dataset[i]},getStartPoint=function(dataset,currindex){for(var flag=!0,i=--currindex;flag&&i>0;)null!=dataset[i]?flag=!1:i--;return dataset[i]},i=0;i<performance.length;i++){var p=performance[i],year=p.details.year.toString(),term=p.details.term.toString();labels.push(["T"+term,year]),null==p.details.avggrades&&(p.details.avggrades=void 0),grades.push(p.details.avggrades),null==p.details.effortaverage&&(p.details.effortaverage=void 0),effort.push(p.details.effortaverage),null==p.details.percentageattended&&(p.details.percentageattended=void 0),attendance.push(p.details.percentageattended)}var skipped=function(ctx,value){return ctx.p0.skip||ctx.p1.skip?value:void 0},sgrades=segments(grades),seffort=segments(effort),sattendance=segments(attendance);sets.push({label:TAGS_avggrades,data:grades,fill:!1,borderColor:"#31326f",segment:{borderDash:function(ctx){return skipped(ctx,sgrades)}},backgroundColor:"#31326f",tension:.1}),sets.push({label:TAGS_avgeffort,data:effort,fill:!1,borderColor:"#ffc93c",segment:{borderDash:function(ctx){return skipped(ctx,seffort)}},backgroundColor:"#ffc93c",tension:.1}),sets.push({label:TAGS_avgattendance,data:attendance,fill:!1,borderColor:"#1687a7",segment:{borderDash:function(ctx){return skipped(ctx,sattendance)}},backgroundColor:"#1687a7",tension:.1});new Chart(ctx,{type:"line",data:{labels:labels,datasets:sets},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(context){if(context.dataset.label==TAGS_avggrades){if(context.parsed.y>0&&context.parsed.y<=20)return TAGS_GRADES_DESC_be;if(context.parsed.y>20&&context.parsed.y<=40)return TAGS_GRADES_DESC_gs;if(context.parsed.y>40&&context.parsed.y<=60)return TAGS_GRADES_DESC_ms;if(context.parsed.y>60&&context.parsed.y<=80)return TAGS_GRADES_DESC_grwi;if(context.parsed.y>80)return TAGS_GRADES_DESC_ae}return context.dataset.label!=TAGS_avgeffort?context.parsed.y+"%":parseFloat(context.parsed.y)>0&&parseFloat(context.parsed.y)<=25?TAGS_EFFORTS_DESC_ni:parseFloat(context.parsed.y)>25&&parseFloat(context.parsed.y)<=50?TAGS_EFFORTS_DESC_avg:parseFloat(context.parsed.y)>50&&parseFloat(context.parsed.y)<95?TAGS_EFFORTS_DESC_vg:parseFloat(context.parsed.y)>=95?TAGS_EFFORTS_DESC_e:void 0}}}},scales:{y:{suggestedMin:25,display:!1}}},plugins:[{id:"custom_canvas_background_color",beforeDraw:function(chart){var ctx=chart.canvas.getContext("2d");ctx.save(),ctx.globalCompositeOperation="destination-over",ctx.fillStyle="#f6f5f5",ctx.fillRect(0,0,chart.width,chart.height),ctx.restore()}}]})}},AcademicInfo.prototype.getEffortHistory=function(){var element=document.querySelector(".grade-effort-trend"),username=element.getAttribute("data-username"),campus=element.getAttribute("data-campus");$("#effort-history-tb").removeAttr("hidden"),Ajax.call([{methodname:"report_mystudent_get_effort_history",args:{username:username,campus:campus},done:function(response){Log.debug(response);var htmlResult=response.html;$("#effort-history-tb").attr("hidden",!0),$('[data-region="effort-history-table"]').replaceWith(htmlResult)},fail:function(reason){Log.error("report_mystudent: Unable to get context."),Log.debug(reason),$('[data-region="effort-history-table"]').replaceWith('<p class="alert alert-danger">Data not available. Please try later</p>')}}])},AcademicInfo.prototype.getGradeHistory=function(){var element=document.querySelector(".grade-effort-trend"),username=element.getAttribute("data-username"),campus=element.getAttribute("data-campus");$("#grade-history-tb").removeAttr("hidden"),Ajax.call([{methodname:"report_mystudent_get_grade_history",args:{username:username,campus:campus},done:function(response){Log.debug(response);var htmlResult=response.html;$("#grade-history-tb").attr("hidden",!0),$('[data-region="grade-history-table"]').replaceWith(htmlResult)},fail:function(reason){Log.error("report_mystudent: Unable to get context."),Log.debug(reason),$('[data-region="grade-history-table"]').replaceWith('<p class="alert alert-danger">Data not available. Please try later</p>')}}])},{init:function(){(new AcademicInfo).main()}}}));

//# sourceMappingURL=gradesandeffort.min.js.map