/**
 * @package   report_mystudent
 * @copyright 2022 Veronica Bermegui
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_mystudent/attendance",["jquery","core/ajax","core/log","report_mystudent/chart"],(function($,Ajax,Log,Chart){function AttendanceControl(origin){if("dashboard"!=origin){var element=document.getElementById("rollmarking-container"),username=element.getAttribute("data-username"),campus=element.getAttribute("data-campus");this.username=username,this.campus=campus}}return AttendanceControl.prototype.main=function(origin){"dashboard"!=origin?this.setupEvents():this.getAttendanceChart()},AttendanceControl.prototype.setupEvents=function(){var self=this;$(".attendance-rollmarking").on("custom.getAttendanceRollmarking",(function(){self.getAttendanceRollmarking()})),$(".attendance-rollmarking").click((function(){$(this).trigger("custom.getAttendanceRollmarking")}))},AttendanceControl.prototype.getAttendanceRollmarking=function(){var username=this.username,campus=this.campus;$("#attendance-based-on-rollmarking-table").removeAttr("hidden"),$("#attendance-based-on-rollmarking-show").toggle(),$("#attendance-based-on-rollmarking-hide").toggle(),Ajax.call([{methodname:"report_mystudent_get_attendance_rollmarking_context",args:{username:username,campus:campus},done:function(response){var htmlResult=response.html;$("#attendance-based-on-rollmarking-table").attr("hidden",!0),$('[data-region="attendance-rollmarking"]').replaceWith(htmlResult)},fail:function(reason){Log.error("block_attendance_report_get_attendance_rollmarking_context: Unable to get context."),Log.debug(reason),$('[data-region="attendance-rollmarking"]').replaceWith('<p class="alert alert-danger">Data not available. Please try later</p>')}}])},AttendanceControl.prototype.getAttendanceChart=function(){var self=this,userid=document.querySelector(".card-deck").getAttribute("data-userid"),campus=document.querySelector("[data-campus]").getAttribute("data-campus");document.querySelector(".card-img-attendance").firstElementChild.style.display="flex",Ajax.call([{methodname:"report_mystudent_get_attendance_by_term",args:{userid:userid,campus:campus},done:function(response){var htmlResult=response.result;Log.debug(htmlResult),Log.debug(self),self.renderAttendanceBarChar(htmlResult)},fail:function(reason){Log.debug(reason),document.querySelector(".card-img-attendance").firstElementChild.style.display="none",$("#card-body-attendance-info-text").replaceWith('<p class="card-text alert alert-danger" id ="card-body-attendance-info-text" >Data not available. Please try later</p>')}}])},AttendanceControl.prototype.renderAttendanceBarChar=function(results){var ctx=document.getElementById("chart-attendance");if(ctx){for(var result=JSON.parse(results),data=[],labels=[],i=0;i<result.length;i++)labels.push("Term ".concat(result[i].filesemester)),data.push(result[i].totalpercentageattended);var config={type:"bar",data:{labels:labels,datasets:[{label:"Term",tension:.4,borderWidth:0,borderRadius:4,borderSkipped:!1,borderColor:"#ffc93c",backgroundColor:"#ffc93c",data:data,maxBarThickness:6}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{suggestedMax:100,min:1}},plugins:{tooltip:{callbacks:{label:function(context){return Y.log(context),"".concat(context.parsed.y," %")}}}}}};document.querySelector(".card-img-attendance").firstElementChild.style.display="none";new Chart(ctx,config)}},{init:function(origin){Log.debug("mystudent: attendance report : initialising controls"),new AttendanceControl(origin).main(origin)}}}));

//# sourceMappingURL=attendance.min.js.map