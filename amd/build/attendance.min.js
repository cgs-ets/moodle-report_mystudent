define ("report_mystudent/attendance",["jquery","core/ajax","core/log","report_mystudent/chart"],function(a,b,c,d){'use strict';function e(a){var b=this;if("dashboard"!=a){var c=document.getElementById("rollmarking-container"),d=c.getAttribute("data-username"),e=c.getAttribute("data-campus");b.username=d;b.campus=e}}e.prototype.main=function(a){var b=this;if("dashboard"!=a){b.setupEvents()}else{b.getAttendanceChart()}};e.prototype.setupEvents=function(){var b=this;a(".attendance-rollmarking").on("custom.getAttendanceRollmarking",function(){b.getAttendanceRollmarking()});a(".attendance-rollmarking").click(function(){a(this).trigger("custom.getAttendanceRollmarking")})};e.prototype.getAttendanceRollmarking=function(){var d=this,e=d.username,f=d.campus;a("#attendance-based-on-rollmarking-table").removeAttr("hidden");a("#attendance-based-on-rollmarking-show").toggle();a("#attendance-based-on-rollmarking-hide").toggle();b.call([{methodname:"report_mystudent_get_attendance_rollmarking_context",args:{username:e,campus:f},done:function done(b){var c=b.html;a("#attendance-based-on-rollmarking-table").attr("hidden",!0);a("[data-region=\"attendance-rollmarking\"]").replaceWith(c)},fail:function fail(b){c.error("block_attendance_report_get_attendance_rollmarking_context: Unable to get context.");c.debug(b);a("[data-region=\"rm-table-container\"]").replaceWith("<p class=\"alert alert-danger\">Data not available. Please try later</p>")}}])};e.prototype.getAttendanceChart=function(){var a=this,d=document.querySelector(".card-deck").getAttribute("data-userid"),e=document.querySelector("[data-campus]").getAttribute("data-campus");document.querySelector(".card-img-attendance").firstElementChild.style.display="flex";b.call([{methodname:"report_mystudent_get_attendance_by_term",args:{userid:d,campus:e},done:function done(b){var d=b.result;c.debug(d);c.debug(a);a.renderAttendanceBarChar(d)},fail:function fail(a){c.debug(a);document.querySelector(".card-img-attendance").firstElementChild.style.display="none"}}])};e.prototype.renderAttendanceBarChar=function(a){var b=document.getElementById("chart-attendance");if(!b){return}for(var c=JSON.parse(a),e=[],f=[],g=0;g<c.length;g++){f.push("Term ".concat(c[g].filesemester));e.push(c[g].totalpercentageattended)}document.querySelector(".card-img-attendance").firstElementChild.style.display="none";new d(b,{type:"bar",data:{labels:f,datasets:[{label:"Term",tension:.4,borderWidth:0,borderRadius:4,borderSkipped:!1,borderColor:"#ffc93c",backgroundColor:"#ffc93c",data:e,maxBarThickness:6}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{suggestedMax:100,min:1}},plugins:{tooltip:{callbacks:{label:function label(a){Y.log(a);return"".concat(a.parsed.y," %")}}}}}})};return{init:function(a){c.debug("mystudent: attendance report : initialising controls");var b=new e(a);b.main(a)}}});
//# sourceMappingURL=attendance.min.js.map
