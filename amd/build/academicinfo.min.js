function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}
//  * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
define("report_mystudent/academicinfo",["jquery","core/log","report_mystudent/chart","core/ajax"],(function($,Log,Chart,Ajax){function filterYear(){var filter,tr,td,i;for(filter=document.getElementById("searchReportInput").value.toUpperCase(),tr=document.getElementById("reports-table").getElementsByTagName("tr"),i=0;i<tr.length;i++){if(td=tr[i].getElementsByTagName("td")[2])(td.textContent||td.innerText).split("/").pop().toUpperCase().indexOf(filter)>-1?tr[i].style.display="":tr[i].style.display="none"}}function filterByClass(e){var filter,tr,td,i,inputid=e.target.id;for(filter=document.getElementById(inputid).value.toUpperCase(),tr=("searchByClassGradeInput"==inputid?document.getElementById("grade-history-table"):document.getElementById("effort-history-table")).getElementsByTagName("tr"),i=1;i<tr.length;i++){var trclasslist=tr[i].classList;trclasslist.contains("reports-heading")||trclasslist.contains("my-student-learning-title")||(td=tr[i].getElementsByTagName("td")[0])&&((td.textContent||td.innerText).toUpperCase().indexOf(filter)>-1?tr[i].style.display="":tr[i].style.display="none")}}function displayReportService(e){var tdocumentsseq=e.target.getAttribute("data-tdss");Ajax.call([{methodname:"report_mystudent_get_student_academic_report",args:{tdocumentsseq:tdocumentsseq},done:function(response){!function(_x){_displayReport.apply(this,arguments)}(JSON.parse(response.blob))},fail:function(reason){Log.error("block_academic_report_get_student_report: Unable to get blob."),Log.debug(reason)}}])}function _displayReport(){return(_displayReport=_asyncToGenerator(regeneratorRuntime.mark((function _callee(base64Data){var base64Response,blob,blobURL;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,fetch("data:application/pdf;base64,".concat(base64Data));case 2:return base64Response=_context.sent,_context.next=5,base64Response.blob();case 5:blob=_context.sent,blobURL=URL.createObjectURL(blob),window.open(blobURL);case 8:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}function popup(e){var modalcontainer;e.target.classList.remove("fa-external-link"),e.target.classList.add("fa-window-close"),e.target.setAttribute("title","Close"),Y.log(e),e.target.classList.contains("pop-up-grade")?(modalcontainer=document.querySelector(".pop-up-grade").closest("div.cgs-grade-history-container").closest("div.cgs-grade-main-container"),document.getElementById("grade-history-table").closest("div.grades-his").classList.add("modal-history-content"),modalcontainer.classList.add("modal-history-background"),document.querySelector(".pop-up-grade.fa-window-close").addEventListener("click",closePopup),document.querySelector(".pop-up-grade").removeEventListener("click",popup)):(modalcontainer=document.querySelector(".pop-up-effort").closest("div.cgs-effort-history-container").closest("div.cgs-effort-main-container"),document.getElementById("effort-history-table").closest("div.effort-his").classList.add("modal-history-content"),modalcontainer.classList.add("modal-history-background"),document.querySelector(".pop-up-effort.fa-window-close").addEventListener("click",closePopup),document.querySelector(".pop-up-effort").removeEventListener("click",popup))}function closePopup(e){var gradepopup=e.target.classList.contains("pop-up-grade"),modalcontentdiv=e.target.classList.contains("pop-up-grade")?e.target.closest("div.grades-his"):e.target.closest("div.effort-his");modalcontentdiv.classList.remove("modal-history-content"),gradepopup?modalcontentdiv.closest(".cgs-grade-main-container").classList.remove("modal-history-background"):modalcontentdiv.closest(".cgs-effort-main-container").classList.remove("modal-history-background"),e.target.classList.add("fa-external-link"),e.target.classList.remove("fa-window-close"),e.target.setAttribute("title","Expand"),document.querySelector(".pop-up-grade").removeEventListener("click",closePopup),document.querySelector(".pop-up-effort").removeEventListener("click",closePopup),document.querySelector(".pop-up-grade").addEventListener("click",popup),document.querySelector(".pop-up-effort").addEventListener("click",popup)}return{init:function(origin){var username,campus;"dashboard"==origin?(username=document.querySelector("[data-username]").getAttribute("data-username"),campus=document.querySelector("[data-campus]").getAttribute("data-campus"),document.getElementById("overlay").style.display="flex",document.querySelector(".card-img-academic").firstElementChild.style.display="flex",Ajax.call([{methodname:"report_mystudent_get_grade_effort_trend",args:{username:username,campus:campus},done:function(response){var htmlResult=response.result;Log.debug(htmlResult),"Senior"==campus?function(result){if(null==result||0===Object.keys(result).length)document.querySelector(".card-img-academic").firstElementChild.style.display="none",$("#card-body-academic-info-text").replaceWith('<p class="card-text alert alert-danger" id ="card-body-academic-info-text" >Data not available.</p>');else{var ctx=document.getElementById("chart-academic");if(!ctx)return;for(var performance=JSON.parse(result),labels=[],sets=[],attendance=[],effort=[],grades=[],gradeperterm=[],TAGS={avgattendance:"Average Attendance",avgeffort:"Average Effort",avggrades:"Average Grade"},i=0;i<performance.length;i++){var p=performance[i],year=p.details.year.toString(),term=p.details.term.toString();labels.push(["T"+term,year]),gradeperterm.push(p.details.avggrades),grades.push(p.details.avggrades),effort.push(p.details.avgeffort),attendance.push(p.details.avgattendance)}sets.push({label:TAGS.avggrades,data:grades,fill:!1,borderColor:"#31326f",backgroundColor:"#31326f",tension:.1,spanGaps:!0}),sets.push({label:TAGS.avgeffort,data:effort,fill:!1,borderColor:"#ffc93c",backgroundColor:"#ffc93c",tension:.1,spanGaps:!0}),sets.push({label:TAGS.avgattendance,data:attendance,fill:!1,borderColor:"#1687a7",backgroundColor:"#1687a7",tension:.1,spanGaps:!0});var data={labels:labels,datasets:sets},options={responsive:!0,maintainAspectRatio:!1};document.querySelector(".card-img-academic").firstElementChild.style.display="none",new Chart(ctx,{type:"line",data:data,options:options})}}(htmlResult):function(result){var ctx=document.getElementById("chart-academic");if(ctx){for(var performance=JSON.parse(result),labels=[],sets=[],attendance=[],effort=[],grades=[],TAGS={avgattendance:"Average Attendance",avgeffort:"Average Effort",avggrades:"Average Grade"},TAGS_EFFORTS_DESC={e:"Excellent (E)",vg:"Very Good (VG)",avg:"Average (AVG)",ni:"Needs Improvement (NI)"},TAGS_GRADES_DESC={be:"Below Expectations",gs:"Good start (GS)",ms:"Making strides (MS)",grwi:"Go run with it (GRWI)",ae:"Above expectations"},i=0;i<performance.length;i++){var p=performance[i],year=p.details.year.toString(),term=p.details.term.toString();labels.push(["T"+term,year]),null==p.details.avggrades&&(p.details.avggrades=void 0),grades.push(p.details.avggrades),null==p.details.effortaverage&&(p.details.effortaverage=void 0),effort.push(p.details.effortaverage),null==p.details.percentageattended&&(p.details.percentageattended=void 0),attendance.push(p.details.percentageattended)}sets.push({label:TAGS.avggrades,data:grades,fill:!1,borderColor:"#31326f",backgroundColor:"#31326f",tension:.1,spanGaps:!0}),sets.push({label:TAGS.avgeffort,data:effort,fill:!1,borderColor:"#ffc93c",backgroundColor:"#ffc93c",tension:.1,spanGaps:!0}),sets.push({label:TAGS.avgattendance,data:attendance,fill:!1,borderColor:"#1687a7",backgroundColor:"#1687a7",tension:.1,spanGaps:!0});var data={labels:labels,datasets:sets},options={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(context){if(context.dataset.label==TAGS.avggrades){if(context.parsed.y>0&&context.parsed.y<=20)return TAGS_GRADES_DESC.be;if(context.parsed.y>20&&context.parsed.y<=40)return TAGS_GRADES_DESC.gs;if(context.parsed.y>40&&context.parsed.y<=60)return TAGS_GRADES_DESC.ms;if(context.parsed.y>60&&context.parsed.y<=80)return TAGS_GRADES_DESC.grwi;if(context.parsed.y>80)return TAGS_GRADES_DESC.ae}return context.dataset.label!=TAGS.avgeffort?context.parsed.y+"%":parseFloat(context.parsed.y)>0&&parseFloat(context.parsed.y)<=25?TAGS_EFFORTS_DESC.ni:parseFloat(context.parsed.y)>25&&parseFloat(context.parsed.y)<=50?TAGS_EFFORTS_DESC.avg:parseFloat(context.parsed.y)>50&&parseFloat(context.parsed.y)<95?TAGS_EFFORTS_DESC.vg:parseFloat(context.parsed.y)>=95?TAGS_EFFORTS_DESC.e:void 0}}}},scales:{y:{suggestedMin:25,display:!0}}};document.querySelector(".card-img-academic").firstElementChild.style.display="none",new Chart(ctx,{type:"line",data:data,options:options})}}(htmlResult)},fail:function(reason){Log.debug(reason),document.querySelector(".card-img-academic").firstElementChild.style.display="none",$("#card-body-academic-info-text").replaceWith('<p class="card-text alert alert-danger" id ="card-body-academic-info-text" >Data not available. Please try later</p>')}}])):(document.getElementById("searchReportInput").addEventListener("keyup",filterYear),document.getElementById("searchByClassGradeInput").addEventListener("keyup",filterByClass),document.getElementById("searchByClassEffortInput").addEventListener("keyup",filterByClass),document.querySelector(".pop-up-grade").addEventListener("click",popup),document.querySelector(".pop-up-effort").addEventListener("click",popup),document.querySelectorAll(".file-pdf").forEach((function(icon){icon.addEventListener("click",displayReportService)})),function(){var element=document.querySelector(".cgs-dashboard-academic-info-container"),username=element.getAttribute("data-username"),campus=element.getAttribute("data-campus");$("#effort-history-tb").removeAttr("hidden"),Ajax.call([{methodname:"report_mystudent_get_effort_history",args:{username:username,campus:campus},done:function(response){Log.debug(response);var htmlResult=response.html;$("#effort-history-tb").attr("hidden",!0),$('[data-region="effort-history-table"]').replaceWith(htmlResult),$(".pop-up-grade").removeAttr("disabled")},fail:function(reason){Log.error("report_mystudent: Unable to get context."),Log.debug(reason),$("#effort-history-tb").attr("hidden",!0),$('[data-region="effort-history-table"]').replaceWith('<p class="alert alert-danger">Data not available. Please try later</p>')}}])}(),function(){var username=document.querySelector(".cgs-dashboard-academic-info-container").getAttribute("data-username");$("#assignment-tb").removeAttr("hidden"),Ajax.call([{methodname:"report_mystudent_get_assign_context",args:{username:username},done:function(response){var htmlResult=response.html;$("#assignment-tb").attr("hidden",!0),$('[data-region="assignment-table"]').replaceWith(htmlResult)},fail:function(reason){Log.error("report_mystudent: Unable to get context."),Log.debug(reason),$("#assignment-tb").attr("hidden",!0),$('[data-region="assignment-table"]').replaceWith('<p class="alert alert-danger">Data not available. Please try later</p>')}}])}(),function(){var element=document.querySelector(".cgs-dashboard-academic-info-container"),username=element.getAttribute("data-username"),campus=element.getAttribute("data-campus");$("#grade-history-tb").removeAttr("hidden"),Ajax.call([{methodname:"report_mystudent_get_grade_history",args:{username:username,campus:campus},done:function(response){Log.debug(response);var htmlResult=response.html;$("#grade-history-tb").attr("hidden",!0),$('[data-region="grade-history-table"]').replaceWith(htmlResult),$(".pop-up-effort").removeAttr("disabled")},fail:function(reason){Log.error("report_mystudent: Unable to get context."),Log.debug(reason),$("#grade-history-tb").attr("hidden",!0),$('[data-region="grade-history-table"]').replaceWith('<p class="alert alert-danger">Data not available. Please try later</p>')}}])}())}}}));

//# sourceMappingURL=academicinfo.min.js.map