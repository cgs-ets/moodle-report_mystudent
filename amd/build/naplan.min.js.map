{"version":3,"file":"naplan.min.js","sources":["../src/naplan.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// /**\n//  * @package   report_mystudent\n//  * @copyright 2022 Veronica Bermegui\n//  * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n//  */\n\ndefine(['jquery', 'report_mystudent/chart', 'core/ajax', 'core/modal_factory'], function ($, Chart, Ajax, ModalFactory) {\n    'use strict';\n\n    function init() {\n        getNaplanResult();\n        open_naplan_scale();\n        close_naplan_scale();\n\n        window.onclick = function (event) {\n            var modal = document.getElementById(\"myModal\");\n            if (event.target == document.getElementById(\"myModal\")) {\n                modal.style.display = \"none\";\n            }\n        }\n    }\n\n    function getNaplanResult() {\n\n        const username = document.querySelector('[data-username]').getAttribute('data-username');\n\n        document.querySelector('.card-top-naplan').firstElementChild.style.display = \"flex\"\n\n        Ajax.call([{\n            methodname: 'report_mystudent_get_naplan_result',\n            args: {\n                username: username,\n            },\n\n            done: function (response) {\n                const htmlResult = response.result;\n                renderBarChar(htmlResult);\n\n            },\n\n            fail: function (reason) {\n                console.log(reason);\n                // remove spinner\n                document.querySelector('.card-body-naplan').firstElementChild.style.display = \"none\"\n                document.querySelector('.card-top-naplan').firstElementChild.style.display = \"none\"\n\n                const pelement = document.createElement('p');\n                pelement.textContent = \"There was a problem when getting data. Please try again later\";\n                document.getElementById('chart-naplan').appendChild(pelement);\n                $('#card-body-naplan-text').replaceWith('<p class=\"card-text alert alert-danger\" id =\"card-body-naplan-text\" >Data not available. Please try later</p>');\n\n            }\n        }]);\n\n    };\n\n\n    function renderBarChar(result) {\n        const isEmpty = result == null || Object.keys(result).length === 0;\n        if (isEmpty) {\n            document.querySelector('.card-top-naplan').firstElementChild.style.display = \"none\";\n            $('#card-body-naplan-text').replaceWith('<p class=\"card-text alert alert-danger\" id =\"card-body-academic-info-text\" >Data not available.</p>');\n        } else {\n\n            const ctx = document.getElementById(\"chart-naplan\");\n            if (!ctx) {\n                return;\n            }\n\n            const results = JSON.parse(result);\n            const datasets = [];\n\n            for (let i = 0; i < results.datasets.length; i++) {\n                let data = {\n                    label: results.datasets[i].label,\n                    data: results.datasets[i].results,\n                    backgroundColor: results.datasets[i].backgroundcolor,\n                    borderColor: results.datasets[i].backgroundcolor,\n                    tension: 0.4,\n                    borderWidth: 0,\n                    borderRadius: 4,\n                    borderSkipped: false,\n                    borderWidth: 1,\n\n                }\n                datasets.push(data);\n            }\n\n\n            const config = {\n                type: 'bar',\n                labels: results.labels,\n                data: {\n                    labels: results.labels,\n                    datasets: datasets,\n                },\n                options: {\n                    scales: {\n                        y: {\n                            suggestedMax: 10,\n                            min: 1,\n                            title: {\n                                text: 'Band',\n                                display: true,\n                            }\n                        },\n                    },\n                    interaction: {\n                        mode: 'point',\n                        intersect: false,\n                    },\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        tooltip: {\n                            callbacks: {\n                                label: function (context) {\n                                    const belowStd = 'Below the national minimun standard';\n                                    const minStd = 'National minimun standard';\n                                    const aboveStd = 'Above the national minimun standard';\n                                    if (context.dataset.label == 'Year 3') {\n                                        if (context.parsed.y >= 3) {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + aboveStd;\n                                        } else if (context.parse.y == 2) {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + minStd;\n                                        } else {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + belowStd;\n                                        }\n                                    } else if (context.dataset.label == 'Year 5') {\n                                        if (context.parsed.y >= 5) {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + aboveStd;\n                                        } else if (context.parse.y == 4) {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + minStd;\n                                        } else {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + belowStd;\n                                        }\n                                    } else if (context.dataset.label == 'Year 7') {\n                                        if (context.parsed.y >= 6) {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + aboveStd;\n                                        } else if (context.parse.y == 5) {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + minStd;\n                                        } else {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + belowStd;\n                                        }\n                                    } else if (context.dataset.label == 'Year 9') {\n                                        if (context.parsed.y >= 7) {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + aboveStd;\n                                        } else if (context.parse.y == 6) {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + minStd;\n                                        } else {\n                                            return context.dataset.label + \": Band \" + context.parsed.y + '. ' + belowStd;\n                                        }\n                                    }\n                                },\n                            }\n                        },\n                    },\n                    legend: {\n                        position: 'top',\n                    },\n\n                }\n            };\n            // remove spinner\n            document.querySelector('.card-top-naplan').firstElementChild.style.display = \"none\";\n            const myChart = new Chart(ctx, config);\n        }\n\n    }\n\n    function open_naplan_scale() {\n        $('a.naplan-scale').on('click', function (e) {\n            var modal = document.getElementById(\"myModal\");\n            modal.style.display = \"block\";\n        });\n    }\n\n    function close_naplan_scale() {\n        $('i.cgs-naplan-close').on('click', function (e) {\n\n            var modal = document.getElementById(\"myModal\");\n            modal.style.display = \"none\";\n        });\n    }\n\n    return {\n        init: init\n    }\n});"],"names":["define","$","Chart","Ajax","ModalFactory","init","username","document","querySelector","getAttribute","firstElementChild","style","display","call","methodname","args","done","response","result","Object","keys","length","replaceWith","ctx","getElementById","results","JSON","parse","datasets","i","data","label","backgroundColor","backgroundcolor","borderColor","tension","borderWidth","borderRadius","borderSkipped","push","config","type","labels","options","scales","y","suggestedMax","min","title","text","interaction","mode","intersect","responsive","maintainAspectRatio","plugins","tooltip","callbacks","context","belowStd","minStd","aboveStd","dataset","parsed","legend","position","renderBarChar","fail","reason","console","log","pelement","createElement","textContent","appendChild","on","e","window","onclick","event","modal","target"],"mappings":"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"}